"use strict";(()=>{var ye=Object.defineProperty;var be=(d,i,e)=>i in d?ye(d,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[i]=e;var o=(d,i,e)=>be(d,typeof i!="symbol"?i+"":i,e);var S=class S{constructor(i={}){o(this,"events",new Map);o(this,"config");o(this,"handlerIdCounter",0);this.config={maxListeners:i.maxListeners??0,errorHandler:i.errorHandler??this.defaultErrorHandler,debug:i.debug??!1}}static getInstance(i){return S.instance||(S.instance=new S(i)),S.instance}on(i,e,t={}){this.events.has(i)||this.events.set(i,[]);let r=this.events.get(i);this.config.maxListeners>0&&r.length>=this.config.maxListeners&&console.error(`[EventBus] Max listeners (${this.config.maxListeners}) reached for event "${String(i)}"`),this.handlerIdCounter+=1;let n={handler:e,options:t,id:`handler-${this.handlerIdCounter}`},s=t.priority??0,a=r.findIndex(l=>(l.options.priority??0)<s);return a===-1?r.push(n):r.splice(a,0,n),()=>{this.off(i,e)}}once(i,e){return this.on(i,e,{once:!0})}off(i,e){let t=this.events.get(i);if(!t)return;if(!e){this.events.delete(i);return}let r=t.findIndex(n=>n.handler===e);r!==-1&&t.splice(r,1),t.length===0&&this.events.delete(i)}emit(i,e,t={}){let r=this.events.get(i);if(!r||r.length===0)return;let n=[...r];for(let s of n)try{let a=s.options.context??void 0;s.handler.call(a,e),s.options.once&&this.off(i,s.handler)}catch(a){if(t.throwOnError)throw a;this.config.errorHandler(a,String(i))}}async emitAsync(i,e,t={}){let r=this.events.get(i);if(!r||r.length===0)return;let n=[...r],s=[];for(let a of n){let l=(async()=>{try{let c=a.options.context??void 0;await a.handler.call(c,e),a.options.once&&this.off(i,a.handler)}catch(c){if(t.throwOnError)throw c;this.config.errorHandler(c,String(i))}})();s.push(l)}await Promise.all(s)}listenerCount(i){return this.events.get(i)?.length??0}removeAllListeners(i){i?this.events.delete(i):this.events.clear()}setMaxListeners(i){this.config.maxListeners=i}getMaxListeners(){return this.config.maxListeners}setDebugMode(i){this.config.debug=i}defaultErrorHandler(i,e){console.error(`[EventBus] Error in handler for "${e}":`,i)}getEventNames(){return Array.from(this.events.keys())}hasListeners(i){return this.listenerCount(i)>0}destroy(){this.removeAllListeners(),S.instance===this&&(S.instance=void 0)}};o(S,"instance");var T=S;var H=class{constructor(){o(this,"prefix","toolkit_")}getFullKey(i){return`${this.prefix}${i}`}parseCookies(){let i={};return document.cookie.split(";").forEach(e=>{let[t,r]=e.trim().split("=");t&&r&&(i[t]=decodeURIComponent(r))}),i}setCookie(i,e,t){let r=encodeURIComponent(e),n=`${i}=${r}`;if(t?.ttl){let s=new Date(Date.now()+t.ttl);n+=`; expires=${s.toUTCString()}`}n+=`; path=${t?.path||"/"}`,t?.domain&&(n+=`; domain=${t.domain}`),t?.secure&&(n+="; secure"),t?.sameSite&&(n+=`; samesite=${t.sameSite}`),document.cookie=n}deleteCookie(i){document.cookie=`${i}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`}get(i){try{let e=this.getFullKey(i),r=this.parseCookies()[e];if(!r)return null;try{let n=JSON.parse(r);return n&&typeof n=="object"&&"_value"in n?n._expires&&n._expires<Date.now()?(this.deleteCookie(e),null):n._value:n}catch{return r}}catch(e){return console.error(`Failed to get cookie: ${i}`,e),null}}set(i,e,t){try{let r=this.getFullKey(i),n={_value:e,_created:Date.now(),_expires:t?.ttl?Date.now()+t.ttl:void 0},s=JSON.stringify(n);if(s.length>4096)throw new Error(`Cookie value too large: ${s.length} bytes`);this.setCookie(r,s,t)}catch(r){throw console.error(`Failed to set cookie: ${i}`,r),r}}remove(i){this.deleteCookie(this.getFullKey(i))}clear(){let i=this.parseCookies();Object.keys(i).forEach(e=>{e.startsWith(this.prefix)&&this.deleteCookie(e)})}has(i){return this.get(i)!==null}keys(){let i=this.parseCookies();return Object.keys(i).filter(e=>e.startsWith(this.prefix)).map(e=>e.substring(this.prefix.length))}size(){return this.keys().length}};var B=class{constructor(){o(this,"prefix","toolkit_")}getFullKey(i){return`${this.prefix}${i}`}isStorageAvailable(){try{let i="__toolkit_test__";return localStorage.setItem(i,"test"),localStorage.removeItem(i),!0}catch{return!1}}get(i){if(!this.isStorageAvailable())return null;try{let e=this.getFullKey(i),t=localStorage.getItem(e);if(!t)return null;let r=JSON.parse(t);return r&&typeof r=="object"&&"_value"in r?r._expires&&r._expires<Date.now()?(localStorage.removeItem(e),null):r._value:r}catch(e){return console.error(`Failed to get value from localStorage: ${i}`,e),null}}set(i,e,t){if(this.isStorageAvailable())try{let r=this.getFullKey(i),n={_value:e,_created:Date.now(),_expires:t?.ttl?Date.now()+t.ttl:void 0};localStorage.setItem(r,JSON.stringify(n))}catch(r){if(console.error(`Failed to set value in localStorage: ${i}`,r),r instanceof DOMException&&r.name==="QuotaExceededError"){this.clearExpired();try{let n=this.getFullKey(i);localStorage.setItem(n,JSON.stringify({_value:e,_created:Date.now()}))}catch{throw new Error("Storage quota exceeded and unable to clear space")}}}}remove(i){this.isStorageAvailable()&&localStorage.removeItem(this.getFullKey(i))}clear(){if(!this.isStorageAvailable())return;let i=[];for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);t?.startsWith(this.prefix)&&i.push(t)}i.forEach(e=>localStorage.removeItem(e))}has(i){return this.get(i)!==null}keys(){if(!this.isStorageAvailable())return[];let i=[];for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);t?.startsWith(this.prefix)&&i.push(t.substring(this.prefix.length))}return i}size(){return this.keys().length}clearExpired(){let i=this.keys(),e=Date.now();i.forEach(t=>{try{let r=this.getFullKey(t),n=localStorage.getItem(r);if(n){let s=JSON.parse(n);s._expires&&s._expires<e&&localStorage.removeItem(r)}}catch{localStorage.removeItem(this.getFullKey(t))}})}};var $=class{constructor(){o(this,"storage",new Map)}get(i){let e=this.storage.get(i);return e?e.expires&&e.expires<Date.now()?(this.storage.delete(i),null):e.value:null}set(i,e,t){let r={value:e};t?.ttl&&(r.expires=Date.now()+t.ttl),this.storage.set(i,r)}remove(i){this.storage.delete(i)}clear(){this.storage.clear()}has(i){return this.get(i)!==null}keys(){let i=Date.now();for(let[e,t]of this.storage.entries())t.expires&&t.expires<i&&this.storage.delete(e);return Array.from(this.storage.keys())}size(){return this.keys().length}};var V=class{constructor(){o(this,"prefix","toolkit_")}getFullKey(i){return`${this.prefix}${i}`}isStorageAvailable(){try{let i="__toolkit_test__";return sessionStorage.setItem(i,"test"),sessionStorage.removeItem(i),!0}catch{return!1}}get(i){if(!this.isStorageAvailable())return null;try{let e=this.getFullKey(i),t=sessionStorage.getItem(e);if(!t)return null;let r=JSON.parse(t);return r&&typeof r=="object"&&"_value"in r?r._expires&&r._expires<Date.now()?(sessionStorage.removeItem(e),null):r._value:r}catch(e){return console.error(`Failed to get value from sessionStorage: ${i}`,e),null}}set(i,e,t){if(this.isStorageAvailable())try{let r=this.getFullKey(i),n={_value:e,_created:Date.now(),_expires:t?.ttl?Date.now()+t.ttl:void 0};sessionStorage.setItem(r,JSON.stringify(n))}catch(r){if(console.error(`Failed to set value in sessionStorage: ${i}`,r),r instanceof DOMException&&r.name==="QuotaExceededError"){this.clearExpired();try{let n=this.getFullKey(i);sessionStorage.setItem(n,JSON.stringify({_value:e,_created:Date.now()}))}catch{throw new Error("Storage quota exceeded and unable to clear space")}}}}remove(i){this.isStorageAvailable()&&sessionStorage.removeItem(this.getFullKey(i))}clear(){if(!this.isStorageAvailable())return;let i=[];for(let e=0;e<sessionStorage.length;e++){let t=sessionStorage.key(e);t?.startsWith(this.prefix)&&i.push(t)}i.forEach(e=>sessionStorage.removeItem(e))}has(i){return this.get(i)!==null}keys(){if(!this.isStorageAvailable())return[];let i=[];for(let e=0;e<sessionStorage.length;e++){let t=sessionStorage.key(e);t?.startsWith(this.prefix)&&i.push(t.substring(this.prefix.length))}return i}size(){return this.keys().length}clearExpired(){let i=this.keys(),e=Date.now();i.forEach(t=>{try{let r=this.getFullKey(t),n=sessionStorage.getItem(r);if(n){let s=JSON.parse(n);s._expires&&s._expires<e&&sessionStorage.removeItem(r)}}catch{sessionStorage.removeItem(this.getFullKey(t))}})}};var M=class M{constructor(){o(this,"adapters");o(this,"defaultType","memory");o(this,"eventBus");this.eventBus=T.getInstance(),this.adapters=new Map,this.adapters.set("memory",new $),this.adapters.set("local",new B),this.adapters.set("session",new V),this.adapters.set("cookie",new H)}static getInstance(){return M.instance||(M.instance=new M),M.instance}static init(){M.getInstance()}getAdapter(i){let e=this.adapters.get(i);if(!e)throw new Error(`Storage adapter not found: ${i}`);return e}setDefaultType(i){if(!this.adapters.has(i))throw new Error(`Invalid storage type: ${i}`);this.defaultType=i}get(i,e=this.defaultType){try{let r=this.getAdapter(e).get(i);return this.eventBus.emit("storage:get",{key:i,type:e}),r}catch(t){return this.eventBus.emit("storage:error",{error:t,operation:"get",key:i}),null}}set(i,e,t=this.defaultType,r){try{this.getAdapter(t).set(i,e,r),this.eventBus.emit("storage:set",{key:i,value:e,type:t})}catch(n){throw this.eventBus.emit("storage:error",{error:n,operation:"set",key:i}),n}}remove(i,e=this.defaultType){try{this.getAdapter(e).remove(i),this.eventBus.emit("storage:remove",{key:i,type:e})}catch(t){this.eventBus.emit("storage:error",{error:t,operation:"remove",key:i})}}clear(i=this.defaultType){try{this.getAdapter(i).clear(),this.eventBus.emit("storage:clear",{type:i})}catch(e){this.eventBus.emit("storage:error",{error:e,operation:"clear"})}}has(i,e=this.defaultType){try{return this.getAdapter(e).has(i)}catch{return!1}}keys(i=this.defaultType){try{return this.getAdapter(i).keys()}catch{return[]}}size(i=this.defaultType){try{return this.getAdapter(i).size()}catch{return 0}}copy(i,e,t,r){try{let n=this.get(i,e);return n===null?!1:(this.set(i,n,t,r),!0)}catch{return!1}}move(i,e,t,r){try{return this.copy(i,e,t,r)?(this.remove(i,e),!0):!1}catch{return!1}}getStats(){let i={memory:{keys:0,available:!0},local:{keys:0,available:!0},session:{keys:0,available:!0},cookie:{keys:0,available:!0}};for(let[e,t]of this.adapters.entries())try{i[e]={keys:t.size(),available:!0}}catch{i[e]={keys:0,available:!1}}return i}};o(M,"instance");var P=M;var x=class x{constructor(){o(this,"storageManager");o(this,"migrations",new Map);this.storageManager=P.getInstance()}static getInstance(){return x.instance||(x.instance=new x),x.instance}static init(){x.getInstance()}save(i,e,t){try{let r=this.filterData(e,t),s={_data:t.serialize?t.serialize(r):this.defaultSerialize(r),_version:t.version||1,_saved:Date.now(),_key:t.key};this.storageManager.set(this.getStorageKey(i,t),s,t.storage,t.options)}catch(r){throw console.error(`Failed to persist data: ${i}`,r),r}}load(i,e){try{let t=this.storageManager.get(this.getStorageKey(i,e),e.storage);if(!t||!t._data)return null;let r=t._data;if(t._version!==(e.version||1)){let s=this.migrateData(e.key,r,t._version,e.version||1);s!==null&&(r=s)}return e.deserialize?e.deserialize(r):this.defaultDeserialize(r)}catch(t){return console.error(`Failed to load persisted data: ${i}`,t),null}}remove(i,e){try{this.storageManager.remove(this.getStorageKey(i,e),e.storage)}catch(t){console.error(`Failed to remove persisted data: ${i}`,t)}}registerMigration(i,e,t,r){this.migrations.has(i)||this.migrations.set(i,new Map),this.migrations.get(i).set(e,r)}migrate(i,e,t,r){this.registerMigration(i,e,t,r)}getPersistedKeys(i){let e=[];return["memory","local","session","cookie"].forEach(r=>{let s=this.storageManager.keys(r).filter(a=>a.startsWith(`${i}:`));e.push(...s)}),Array.from(new Set(e))}clearNamespace(i){let e=this.getPersistedKeys(i),t=["memory","local","session","cookie"];e.forEach(r=>{t.forEach(n=>{this.storageManager.has(r,n)&&this.storageManager.remove(r,n)})})}exportNamespace(i){let e=this.getPersistedKeys(i),t={},r=["memory","local","session","cookie"];return e.forEach(n=>{for(let s of r){let a=this.storageManager.get(n,s);if(a!==null){t[n]=a;break}}}),t}importNamespace(i,e,t="memory"){Object.entries(e).forEach(([r,n])=>{r.startsWith(`${i}:`)&&this.storageManager.set(r,n,t)})}getStorageKey(i,e){return`${e.key}:${i}`}filterData(i,e){if(!i||typeof i!="object")return i;let t=i,r={};return e.include&&e.include.length>0?(e.include.forEach(n=>{n in t&&(r[n]=t[n])}),r):(Object.entries(t).forEach(([n,s])=>{(!e.exclude||!e.exclude.includes(n))&&(r[n]=s)}),r)}defaultSerialize(i){if(i===null||typeof i=="string"||typeof i=="number"||typeof i=="boolean")return i;if(Array.isArray(i)||typeof i=="object"&&i!==null)return JSON.parse(JSON.stringify(i));throw new Error(`Cannot serialize data of type: ${typeof i}`)}defaultDeserialize(i){return i}migrateData(i,e,t,r){let n=this.migrations.get(i);if(!n)return console.warn(`No migrations found for key: ${i}`),e;let s=e,a=t;for(;a<r;){let l=n.get(a);l?s=l(s):console.warn(`No migration found from version ${a} to ${a+1}`),a+=1}return s}};o(x,"instance");var D=x;var C=class C{constructor(){o(this,"state",new Map);o(this,"stateConfigs",new Map);o(this,"eventBus");o(this,"persistenceManager");o(this,"namespace","app-state");this.eventBus=T.getInstance(),this.persistenceManager=D.getInstance()}static getInstance(){return C.instance||(C.instance=new C),C.instance}static init(){C.getInstance().restorePersistedState()}configure(i,e){this.stateConfigs.set(i,e),e.defaultValue!==void 0&&!this.state.has(i)&&this.set(i,e.defaultValue,{skipPersist:!0})}set(i,e,t){let r=this.state.get(i);this.state.set(i,e);let n=this.stateConfigs.get(i);n?.persistent&&!t?.skipPersist&&this.persistValue(i,e,n),this.eventBus.emit("state:changed",{key:i,from:r,to:e,timestamp:Date.now()})}get(i){return this.state.get(i)}getOrDefault(i,e){return this.state.has(i)?this.state.get(i):e}has(i){return this.state.has(i)}remove(i){let e=this.state.get(i),t=this.stateConfigs.get(i);this.state.delete(i),this.stateConfigs.delete(i),t?.persistent&&this.removePersistedValue(i,t),this.eventBus.emit("state:removed",{key:i,value:e,timestamp:Date.now()})}clear(i){let e=i?.keepPersisted?Array.from(this.stateConfigs.entries()).filter(([,t])=>t.persistent).map(([t])=>t):[];this.state.clear(),i?.keepPersisted?e.forEach(t=>{let r=this.stateConfigs.get(t);if(r){let n=this.loadPersistedValue(t,r);n!==null&&this.state.set(t,n)}}):(this.stateConfigs.clear(),this.persistenceManager.clearNamespace(this.namespace))}keys(){return Array.from(this.state.keys())}entries(){return Array.from(this.state.entries())}size(){return this.state.size}watch(i,e){let t=r=>{r.key===i&&e(r.to,r.from)};return this.eventBus.on("state:changed",t)}computed(i,e){return()=>{let t={};return i.forEach(r=>{t[r]=this.get(r)}),e(t)}}batch(i){Object.entries(i).forEach(([e,t])=>{this.set(e,t)})}export(i=!1){let e={};if(this.state.forEach((t,r)=>{e[r]=t}),i){let t={};return this.stateConfigs.forEach((r,n)=>{t[n]=r}),{state:e,configs:t}}return{state:e}}import(i){i.configs&&Object.entries(i.configs).forEach(([e,t])=>{this.configure(e,t)}),this.batch(i.state)}persistValue(i,e,t){let r={key:this.namespace,storage:t.storage||"local",version:1};try{this.persistenceManager.save(i,e,r)}catch(n){console.error(`Failed to persist state: ${i}`,n)}}loadPersistedValue(i,e){let t={key:this.namespace,storage:e.storage||"local",version:1};try{return this.persistenceManager.load(i,t)}catch(r){return console.error(`Failed to load persisted state: ${i}`,r),null}}removePersistedValue(i,e){let t={key:this.namespace,storage:e.storage||"local",version:1};try{this.persistenceManager.remove(i,t)}catch(r){console.error(`Failed to remove persisted state: ${i}`,r)}}restorePersistedState(){this.stateConfigs.forEach((i,e)=>{if(i.persistent&&!this.state.has(e)){let t=this.loadPersistedValue(e,i);t!==null&&this.set(e,t,{skipPersist:!0})}})}};o(C,"instance");var Y=C;var Q=class extends Error{constructor(e,t,r,n){super(e);this.componentId=t;this.phase=r;this.cause=n;this.name="ComponentError"}};var X=class{constructor(i={}){o(this,"group");o(this,"id");o(this,"props");o(this,"metadata");o(this,"rootElement",null);o(this,"elements",new Map);this.metadata={name:this.constructor.name,initialized:!1,destroyed:!1},this.props=i,this.group=i.group,this.id=i.id||this.generateId(),i.autoInit&&this.init()}async init(){if(this.metadata.initialized){this.logWarn("Component already initialized");return}try{this.metadata.initTime=Date.now(),await this.onInit(),this.metadata.initialized=!0}catch(i){throw this.createError(`Failed to initialize: ${i}`,"init")}}async destroy(){if(this.metadata.destroyed){this.logWarn("Component already destroyed");return}try{this.metadata.destroyTime=Date.now(),await this.onDestroy(),this.elements.clear(),this.rootElement=null,this.metadata.destroyed=!0,this.metadata.initialized=!1,this.logDebug("Component destroyed")}catch(i){throw this.createError(`Failed to destroy: ${i}`,"destroy")}}query(i,e={}){let{required:t=!1,parent:r=this.rootElement||document}=e;if(i instanceof HTMLElement)return i;if(!i){if(t)throw this.createError("Selector is required","runtime");return null}let n=r.querySelector(i);if(!n&&t)throw this.createError(`Required element not found: ${i}`,"runtime");return n}queryAll(i,e={}){let{parent:t=this.rootElement||document}=e;return Array.from(t.querySelectorAll(i))}setRootElement(i,e){let t=this.query(i,{...e,required:!0});t&&(this.rootElement=t,t.dataset.componentId=this.id,this.props.className&&t.classList.add(this.props.className))}getRootElement(){return this.rootElement}cacheElement(i,e,t){let r=this.query(e,t);r&&this.elements.set(i,r)}getElement(i){return this.elements.get(i)||null}isInitialized(){return this.metadata.initialized&&!this.metadata.destroyed}isDestroyed(){return this.metadata.destroyed}getId(){return this.id}getMetadata(){return{...this.metadata}}generateId(){let i=crypto.randomUUID();return`${this.metadata.name}-${i}`}createError(i,e="runtime",t){return new Q(`[${this.id}] ${i}`,this.id,e,t)}setText(i,e){i&&(i.textContent=e)}setHTML(i,e,t=!1){if(i)if(t){let r=document.createElement("div");r.textContent=e,i.innerHTML=r.innerHTML}else i.innerHTML=e}setAttribute(i,e,t){i&&i.setAttribute(e,t)}toggleVisibility(i,e){i&&(e===void 0?i.hidden=!i.hidden:i.hidden=!e)}toggleClass(i,e,t){i&&i.classList.toggle(e,t)}groupStart(i,e=!0){this.props.debug&&(e?console.groupCollapsed(i):console.group(i))}groupEnd(){console.groupEnd()}timeDebug(i,e=!1){this.props.debug&&(e&&console.timeEnd(i),e||console.time(i))}logDebug(...i){this.props.debug&&console.log(...i)}logWarn(...i){console.warn(...i)}logError(...i){console.error(...i)}logTable(i,e){console.table(i,e)}};var Z=class extends X{constructor(e={}){super(e);o(this,"eventBus");o(this,"listeners",new Map);o(this,"eventUnsubscribers",[]);o(this,"delegatedHandlers",new Map);this.eventBus=T.getInstance({debug:!0})}async onInit(){await this.setupEventListeners(),this.props.events&&this.bindConfigEvents()}async onDestroy(){this.removeAllListeners(),this.removeAllSubscriptions(),this.removeDelegatedHandlers()}addEventListener(e,t,r,n){let s,a;if(typeof e=="string"){let l=this.getElement(e);if(!l){this.logWarn(`Cached element not found: ${e}`);return}s=l,a=`${e}-${t}`}else s=e,a=`${s.constructor.name}-${t}`;this.listeners.has(a)&&this.removeEventListener(a),s.addEventListener(t,r,n),this.listeners.set(a,{element:s,event:t,handler:r,options:n||void 0}),this.logDebug(`Added listener: ${a}`)}removeEventListener(e){let t=this.listeners.get(e);t&&(t.element.removeEventListener(t.event,t.handler,t.options),this.listeners.delete(e),this.logDebug(`Removed listener: ${e}`))}removeAllListeners(){this.listeners.forEach((e,t)=>{this.removeEventListener(t)})}delegate(e,t,r,n=document){let s=l=>{let g=l.target.closest(t);g&&n.contains(g)&&r.call(this,l,g)},a=`${e}-${t}`;this.delegatedHandlers.has(a)&&n.removeEventListener(e,this.delegatedHandlers.get(a)),n.addEventListener(e,s,!0),this.delegatedHandlers.set(a,s)}removeDelegatedHandlers(){this.delegatedHandlers.forEach((e,t)=>{let[r]=t.split("-");r&&document.removeEventListener(r,e,!0)}),this.delegatedHandlers.clear()}subscribe(e,t,r){let n=this.eventBus.on(e,t,r);this.eventUnsubscribers.push(n)}subscribeOnce(e,t){let r=this.eventBus.once(e,t);this.eventUnsubscribers.push(r)}removeAllSubscriptions(){this.eventUnsubscribers.forEach(e=>e()),this.eventUnsubscribers=[]}emit(e,t){this.eventBus.emit(e,t)}emitCustom(e,t,r){let n=r||this.rootElement||document.body,s=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});n.dispatchEvent(s)}bindConfigEvents(){let e=this.props;!e.events||!this.rootElement||Object.entries(e.events).forEach(([t,r])=>{this.addEventListener(this.rootElement,t,r.bind(this))})}onClick(e,t,r=0){let n=r>0?this.debounce(t,r):t;this.addEventListener(e,"click",n)}onInput(e,t,r=0){let n=r>0?this.debounce(t,r):t;this.addEventListener(e,"input",n)}debounce(e,t){let r=null;return(...n)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{e.apply(this,n)},t)}}async waitForElement(e,t=5e3,r=document){return new Promise((n,s)=>{let a=r.querySelector(e);if(a){n(a);return}let l=new MutationObserver((c,g)=>{let f=r.querySelector(e);f&&(g.disconnect(),n(f))});l.observe(r===document?document.body:r,{childList:!0,subtree:!0}),setTimeout(()=>{l.disconnect(),s(this.createError(`Element not found: ${e}`,"runtime"))},t)})}getActiveListeners(){return new Map(this.listeners)}getListenerCount(){return this.listeners.size+this.eventUnsubscribers.length}};var ee=class extends Z{constructor(e={}){super(e);o(this,"state");o(this,"stateConfigs",new Map);o(this,"stateManager");o(this,"storageManager");o(this,"persistenceManager");o(this,"statePrefix");o(this,"initialState",{});this.state={},this.stateManager=Y.getInstance(),this.storageManager=P.getInstance(),this.persistenceManager=D.getInstance(),this.statePrefix=e.statePrefix||this.id,e.state&&(Array.isArray(e.state)?e.state:[e.state]).forEach(r=>this.configureState(r))}async onInit(){await super.onInit(),this.restoreState(),this.subscribeToStateChanges()}async onDestroy(){this.props.persistState&&this.persistState(),await super.onDestroy()}configureState(e){let t=e.key;this.stateConfigs.set(t,e),e.defaultValue!==void 0&&(this.state[t]=e.defaultValue,this.initialState[t]=e.defaultValue)}getState(e){return this.state[e]}setState(e,t,r={}){let n=this.state[e];if(this.isEqual(n,t))return!1;let s=this.stateConfigs.get(e);if(s?.validate&&!s.validate(t))return this.logWarn(`State validation failed for ${String(e)}:`,t),!1;let a=s?.transform?s.transform(t):t;return this.state[e]=a,r.persist!==!1&&this.persistStateKey(e,a),r.silent||this.onStateChange(e,n,a),!0}setStates(e,t={}){let r=[];Object.entries(e).forEach(([n,s])=>{let a=n,l=this.state[a];this.setState(a,s,{...t,silent:!0})&&r.push({key:a,from:l,to:s})}),!t.silent&&r.length>0&&r.forEach(({key:n,from:s,to:a})=>{this.onStateChange(n,s,a)})}resetState(e){(e||Object.keys(this.state)).forEach(r=>{r in this.initialState&&this.setState(r,this.initialState[r])})}getAllState(){return{...this.state}}subscribeToStateChanges(){this.subscribe("state:changed",e=>{if(e.key.startsWith(this.statePrefix)){let t=e.key.replace(`${this.statePrefix}.`,"");t in this.state&&this.setState(t,e.to,{silent:!1,persist:!1})}})}onStateChange(e,t,r){let n={key:String(e),from:t,to:r,component:this.id};this.emitCustom("state:changed",n),this.emit("state:changed",{key:`${this.statePrefix}.${String(e)}`,from:t,to:r,timestamp:Date.now()}),this.handleStateChange(e,t,r)}persistStateKey(e,t){let r=this.stateConfigs.get(e);if(!r)return;let n={key:this.statePrefix,storage:r.storage||"memory",version:1};try{this.persistenceManager.save(String(e),t,n)}catch(s){this.logError(`Failed to persist state: ${String(e)}`,s)}}persistState(){Object.entries(this.state).forEach(([e,t])=>{this.persistStateKey(e,t)})}restoreState(){this.stateConfigs.forEach((e,t)=>{let r={key:this.statePrefix,storage:e.storage||"memory",version:1};try{let n=this.persistenceManager.load(String(t),r);n!==null&&this.setState(t,n,{silent:!0,persist:!1})}catch(n){this.logError(`Failed to restore state: ${String(t)}`,n)}})}isEqual(e,t){if(e===t)return!0;if(e==null||t==null||typeof e!="object"||typeof t!="object")return!1;let r=Object.keys(e),n=Object.keys(t);return r.length!==n.length?!1:r.every(s=>this.isEqual(e[s],t[s]))}createComputed(e,t){return()=>t(this.state)}watchState(e,t){let r=n=>{let{detail:s}=n;s.key===String(e)&&t(s.to,s.from)};return this.rootElement?.addEventListener("state:changed",r),()=>{this.rootElement?.removeEventListener("state:changed",r)}}};var p="data-form";var oe={byField:!0,byGroup:!0,bySet:!0,byCard:!0};var le={form:!0,card:!0,set:!0,group:!0,field:!0,input:!0,prev:!0,next:!0,submit:!0,"progress-line":!0};var de={native:!0};var ue={memory:!0};var ce={fade:!0,slide:!0,none:!0};function se(d){return d.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function Ie(d){return d.querySelector("legend")?.textContent?.trim()||null}function F(d,i,e,t){let r=d.getAttribute(`${p}-${i}title`);if(r?.trim()){let a=r.trim();return{title:a,source:"attribute",id:e||se(a)}}if(i==="set"||i==="group"){let a=Ie(d);if(a)return{title:a,source:"legend",id:e||se(a)}}if(e)return{title:e.split("-").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "),source:"attribute",id:e};let n=`${i}-${t}`;return{title:`${i.charAt(0).toUpperCase()+i.slice(1)} ${t+1}`,source:"generated",id:n}}function pe(d){let i={};return Array.from(d.attributes).forEach(e=>{if(e.name.startsWith(`${p}-`)){let t=e.name.replace(`${p}-`,"");i[t]=e.value}}),i}function k(d,i=!1){return d===void 0?i:d==="true"||d===""}function E(d,i){return d?d in i:!1}function L(d,i,e,t){if(!E(d,i)){let r=Object.keys(i).join(", "),n=t?`${t}: `:"";throw new Error(`${n}Invalid ${e} "${d}". Valid types are: ${r}`)}}function ge(d){return E(d,oe)}function ae(d,i){L(d,le,"element type",i)}function me(d){return E(d,de)}function he(d){return E(d,ue)}function fe(d){return E(d,ce)}function y(d){let i=d.trim();if(i.includes(":")){let e=i.split(":"),t=e[0].trim();return ae(t),{type:t,id:e[1].trim()}}return ae(i),{type:i,id:void 0}}function ve(d,i){if(d===void 0)return i;let e=parseInt(d,10);return isNaN(e)?i:e}var m=class d{static buildFromParent(i,e){let t={formId:e};return i&&(t[`${i.type}Id`]=i.id,t[`${i.type}Index`]=i.index,"parentHierarchy"in i&&i.parentHierarchy&&Object.assign(t,i.parentHierarchy)),t}static findParentHierarchy(i,e,t){let r;return i instanceof HTMLElement?r=t(i):r=i,d.buildFromParent(r,e.getId())}static findParentByElement(i,e,t){let r=i.closest(`[${p}-element^="${e}"]`);return r?t().find(a=>a.element===r):void 0}};var A=class{constructor(){o(this,"items",[]);o(this,"itemMap",new Map)}add(i){this.items.push(i),this.itemMap.set(i.id,i)}update(i){this.itemMap.set(i.id,i),this.items[i.index]=i}merge(i,e){let t={...i,...e};this.update(t)}getAll(){return this.items}getById(i){return this.itemMap.get(i)}getByIndex(i){return this.items.find(e=>e.index===i)}getBySelector(i){return typeof i=="string"?this.getById(i):this.getByIndex(i)}getByDOM(i){return this.items.find(e=>e.element===i)}filter(i){return this.items.filter(i)}find(i){return this.items.find(i)}clear(){this.items=[],this.itemMap.clear()}get length(){return this.items.length}};var h=class{constructor(i){o(this,"form");this.form=i}groupStart(i,e=!0){this.form.groupStart(i,e)}groupEnd(){this.form.groupEnd()}logDebug(...i){this.form.logDebug(...i)}logWarn(...i){this.form.logWarn(...i)}logError(...i){this.form.logError(...i)}logTable(i,e){this.form.logTable(i,e)}createError(i,e="runtime",t){return this.form.createError(i,e,t)}};var K=class extends h{constructor(){super(...arguments);o(this,"store",new A);o(this,"activeListeners",[]);o(this,"handleClick",e=>{if(e==="submit"){let r={};this.form.logDebug("Submit clicked: requesting form submission",{payload:r}),this.form.emit("form:submit:request",r);return}let t={type:e};this.form.logDebug(`Button clicked: requesting navigation to ${e}`,{payload:t}),this.form.emit("form:navigation:request",t)})}init(){this.groupStart("Initializing Buttons"),this.discoverItems(),this.setupEventListeners(),this.applyStates(!0),this.form.logDebug("Initialized"),this.groupEnd()}destroy(){this.store.clear(),this.unbindAllButtons(),this.form.logDebug("ButtonManager destroyed")}discoverItems(){let e=this.form.getRootElement();if(!e)throw this.form.createError("Cannot discover navigation buttons: root element is null","init",{cause:e});let t=this.form.queryAll(`[${p}-element="prev"], [${p}-element="next"], [${p}-element="submit"]`);this.store.clear(),t.forEach((r,n)=>{let s=this.createItemData(r,n);s&&this.store.add(s)}),this.form.logDebug(`Discovered ${this.store.length} buttons`,{prev:this.store.filter(r=>r.type==="prev"),next:this.store.filter(r=>r.type==="next"),submit:this.store.filter(r=>r.type==="submit")})}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(!["prev","next","submit"].includes(n.type))return;let s=e instanceof HTMLButtonElement?e:e.querySelector("button")??e.querySelector("a");if(!s)throw this.form.createError("Cannot discover navigation buttons: button is null","init",{cause:e});if(s instanceof HTMLAnchorElement)throw this.form.createError("Cannot discover navigation buttons: button is a link","init",{cause:e});let a=`${n.type}-button-${t}`;return this.buildItemData({element:e,index:t,id:a,active:!1,type:n.type,parentHierarchy:this.findParentHierarchy(e),button:s,disabled:!0,visible:!1})}buildItemData(e){let t=this.determineActive(e.element),r=this.determineVisible(e.type),n=this.determineEnabled(e.type,t&&r);return{...e,active:t,visible:r,disabled:!n}}determineActive(e){let t=this.findParentItem(e);return t?t.active:!0}determineVisible(e){let{current:t,total:r}=this.getRelevantState(),{currentCardIndex:n,totalCards:s,currentSetIndex:a,totalSets:l}=this.form.getAllState();switch(e){case"prev":return s>0&&n>0||l>0&&a>0;case"next":return t!==r-1;case"submit":return t===r-1}}determineEnabled(e,t=!0){if(!t)return!1;let{current:r,total:n}=this.getRelevantState(),s=this.form.inputManager.getByFilter(a=>a.active&&a.isIncluded).every(a=>a.isValid);switch(e){case"prev":return t;case"next":return s&&r<n-1;case"submit":return s&&r===n-1}}getRelevantState(){let e=this.form.getBehavior(),t=this.form.getAllState(),r,n;switch(e){case"byField":r=t.currentFieldIndex,n=t.totalFields;break;case"byGroup":r=t.currentGroupIndex,n=t.totalGroups;break;case"bySet":r=t.currentSetIndex,n=t.totalSets;break;case"byCard":r=t.currentCardIndex,n=t.totalCards;break;default:throw this.form.createError("Cannot determine button visibility: invalid behavior","init",{cause:e})}return{current:r,total:n}}findParentHierarchy(e){return m.findParentHierarchy(e,this.form,t=>this.findParentItem(t))}findParentItem(e){let t=m.findParentByElement(e,"set",()=>this.form.setManager.getAll()),r=m.findParentByElement(e,"card",()=>this.form.cardManager.getAll());return t??r}setupEventListeners(){this.bindActiveButtons(),this.form.subscribe("form:navigation:changed",()=>{this.calculateStates(),this.applyStates(),this.handleActiveButtons()}),this.form.subscribe("form:input:changed",()=>{this.calculateStates(),this.applyStates()}),this.form.logDebug("Event listeners setup")}bindActiveButtons(){let e=0;this.getActive().forEach(r=>{let{button:n}=r;if(this.activeListeners.some(l=>l.button===n))return;let a=()=>{this.handleClick(r.type)};n.addEventListener("click",a),this.activeListeners.push({button:n,index:r.index,type:r.type,event:"click",handler:a}),this.logDebug(`Bound "click" events to "${r.type}" button`,{...r.parentHierarchy}),e+=1}),this.logDebug(`Bound listeners to ${e} button${e!==1?"s":""}`)}unbindInactiveButtons(){let e=0,t=this.getActive();this.activeListeners=this.activeListeners.filter(r=>{let n=!t.find(s=>s.index===r.index);if(n){r.button.removeEventListener(r.event,r.handler);let s=this.findParentHierarchy(r.button);this.logDebug(`Unbound "${r.event}" events from ${r.type} button`,{...s}),e+=1}return!n}),this.logDebug(`Unbound listeners from ${e} input${e!==1?"s":""}`)}unbindAllButtons(){this.activeListeners.forEach(e=>{e.button.removeEventListener(e.event,e.handler)}),this.activeListeners=[]}calculateStates(){this.getAll().forEach(e=>{let t=this.buildItemData(e);this.store.update(t)})}handleActiveButtons(){this.unbindInactiveButtons(),this.bindActiveButtons()}applyStates(e=!1){this.logDebug(`${e?"Initializing":"Updating"} button states`),this.getAll().forEach(t=>{t.button.disabled=t.disabled,t.visible?t.element.style.removeProperty("display"):t.element.style.display="none"})}getAll(){return this.store.getAll()}getByType(e){return this.store.filter(t=>t.type===e)}getActive(){return this.store.filter(e=>e.active&&e.visible)}getAllByParent(e){return this.store.filter(t=>t.parentHierarchy===e)}getTypeByParent(e,t){return this.getAllByParent(e).filter(n=>n.type===t)}};var I=class extends h{constructor(){super(...arguments);o(this,"store",new A);o(this,"navigationOrder",[])}init(e=!0){this.groupStart(`Initializing ${this.itemType}s`),this.discoverItems(),this.itemType!=="input"&&this.buildNavigationOrder(),this.setStates(),e&&this.onInitialized()}onInitialized(){this.logDebug("Initialized",{items:this.getAll()}),this.groupEnd()}destroy(){this.clear(),this.logDebug(`${this.constructor.name} destroyed`)}discoverItems(){let e=this.form.getRootElement();if(!e)throw this.createError(`Cannot discover ${this.itemType}s: root element is undefined`,"init",{cause:{manager:this.constructor.name,rootElement:e}});let t=this.form.queryAll(`[${p}-element^="${this.itemType}"]`);this.clear(),t.forEach((r,n)=>{let s=this.createItemData(r,n);s&&this.add(s)}),this.logDebug(`Discovered ${t.length} ${this.itemType}s`,{items:t})}updateItemData(e,t={}){if(typeof e=="number"&&e<0||typeof e=="number"&&e>=this.length)return;let r=this.getBySelector(e);if(!r){this.logWarn(`Cannot update ${this.itemType} data: ${e} not found`);return}let n=this.mergeItemData(r,t);this.update(n),this.logDebug(`Updated ${this.itemType} "${r.id}" data`,{updated:n})}mergeItemData(e,t){return{...this.buildItemData(e),visited:!0,...t}}rebuildAll(){this.getAll().forEach(e=>{let t=this.buildItemData(e);this.update(t)})}determineActive(e,t){let r=this.form.getBehavior(),n=this.findParentItem(e);return n?this.behaviorRequiresFirstChild(r)?n.active&&t===0:n.active:t===0}behaviorRequiresFirstChild(e){return{byField:["field","group","set","card"],byGroup:["group","set","card"],bySet:["set","card"],byCard:["card"]}[e]?.includes(this.itemType)??!1}getActiveIndices(){return this.getByFilter(e=>e.active).map(e=>e.index)}setCurrent(e){let t=this.getBySelector(e);if(!t){this.logWarn(`Set current: ${this.itemType} not found`,{selector:e});return}if(!t.active){this.logWarn(`Set current: ${this.itemType} is not active, cannot set current`,{id:t.id,index:t.index});return}this.clearCurrent(),this.updateItemData(t.index,{current:!0}),this.logDebug(`${this.itemType}: Set current`,{id:t.id,index:t.index,items:this.getAll()})}clearCurrent(){this.getAll().forEach(e=>{e.current&&this.updateItemData(e.index,{current:!1})}),this.logDebug(`Cleared current flag for all ${this.itemType}s`)}clearActiveAndCurrent(){this.getAll().forEach(e=>{let t={...e,active:!1,current:!1};this.update(t)}),this.logDebug(`Cleared active and current flags for all ${this.itemType}s`,{count:this.length,items:this.getAll()})}setActive(e){let t=this.getBySelector(e);if(!t){this.logWarn(`Set active: ${this.itemType} not found`,{selector:e});return}let r={...t,active:!0};this.update(r),this.logDebug(`Set active flag for ${this.itemType}: ${t.id}`,{id:t.id,index:t.index,items:this.getAll()})}setActiveByParent(e,t,r){let{firstIsCurrent:n=!1}=r??{},s=this.getItemsByParentId(e,t);s.forEach((a,l)=>{let g={...this.buildItemData(a),active:!0,current:l===0&&n};this.update(g)}),this.logDebug(`${this.itemType}: Set active: "true" by parent ${t}: ${e}`,{total:s.length,children:s})}getItemsByParentId(e,t){return this.getByFilter(r=>{if(r.type==="card")return!1;let{parentHierarchy:n}=r;if(!n)return!1;switch(t){case"field":return"fieldId"in n&&n.fieldId===e;case"group":return"groupId"in n&&n.groupId===e;case"set":return"setId"in n&&n.setId===e;case"card":return"cardId"in n&&n.cardId===e;default:return!1}})}findParentByElement(e,t,r){let n=e.closest(`[${p}-element^="${t}"]`);if(!n)return;let a=r().find(l=>l.element===n);if(!a)throw this.createError(`Cannot find parent ${t}: no parent item found`,"init",{cause:{child:e,parentElement:n}});return a}findParentHierarchy(e){return this.itemType==="card"?{formId:this.form.getId()}:m.findParentHierarchy(e,this.form,t=>this.findParentItem(t))}buildNavigationOrder(){this.navigationOrder=this.getByFilter(t=>"isIncluded"in t?t.isIncluded:!0).map(t=>t.index);let e=this.navigationOrder.reduce((t,r)=>{if(r===0)return t;let n=this.getByIndex(r);return`${t} --> ${n?.id}`},`${this.getByIndex(0)?.id}`);this.logDebug(`Navigation order built: ${e}`)}handleInclusion(e,t){let r=this.getById(e);r&&(this.updateItemData(e,{isIncluded:t}),this.buildNavigationOrder(),this.logDebug(`Inclusion updated for ${r.type} "${e}" to ${t}`))}add(e){this.store.add(e)}update(e){this.store.update(e)}merge(e,t){this.store.merge(e,t)}clear(){this.store.clear()}getAll(){return this.store.getAll()}getById(e){return this.store.getById(e)}getByIndex(e){return this.store.getByIndex(e)}getBySelector(e){return this.store.getBySelector(e)}getByDOM(e){return this.store.getByDOM(e)}getByFilter(e){return this.store.filter(e)}getByFind(e){return this.store.find(e)}get length(){return this.store.length}getActive(){return this.getByFilter(e=>e.active)}getAllByParentId(e,t){return this.getByFilter(r=>{if(!("parentHierarchy"in r))return!1;switch(t){case"card":return"cardId"in r.parentHierarchy&&r.parentHierarchy.cardId===e;case"set":return"setId"in r.parentHierarchy&&r.parentHierarchy.setId===e;case"group":return"groupId"in r.parentHierarchy&&r.parentHierarchy.groupId===e;case"field":return"fieldId"in r.parentHierarchy&&r.parentHierarchy.fieldId===e;default:return!1}})}getCurrent(){return this.getByFind(e=>e.current)}getCurrentIndex(){let e=this.getCurrent();return e?e.index:-1}getCurrentId(){return this.getCurrent()?.id}isFirst(){return this.getCurrentIndex()===0}isLast(){return this.getCurrentIndex()===this.length-1}getNavigationOrder(){return this.navigationOrder}getNextPosition(){let e=this.getCurrentIndex();if(e===void 0)return;let t=this.navigationOrder.indexOf(e);if(!(t>=this.navigationOrder.length-1))return this.navigationOrder[t+1]}getPrevPosition(){let e=this.getCurrentIndex();if(e===void 0)return;let t=this.navigationOrder.indexOf(e);if(!(t<=0))return this.navigationOrder[t-1]}setStates(){let e=this.calculateStates();this.form.setStates(e)}};var O=class extends I{constructor(){super(...arguments);o(this,"itemType","card")}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(n.type!==this.itemType)return;let s=F(e,this.itemType,n.id,t),a=!!e.querySelector(`[${p}-element^="set"]`);return{element:e,index:t,id:s.id,visible:!0,active:t===0,type:this.itemType,parentHierarchy:this.findParentHierarchy(e),visited:t===0,completed:!a,current:t===0,title:s.title,progress:a?0:100,isIncluded:!0,isValid:!a}}calculateStates(){let e=this.getCurrent(),t=e?e.index:-1,r=e?e.id:null,n=e?e.title:null,s=t>0?t-1:null,a=t<this.length-1?t+1:null,l=new Set(this.getByFilter(u=>u.completed).map(u=>u.id)),c=new Set(this.getByFilter(u=>u.visited).map(u=>u.id)),g=this.length,f=l.size,b=this.getAll().reduce((u,v)=>(u[v.id]=v.isValid,u),{});return{currentCardIndex:t,currentCardId:r,currentCardTitle:n,activeCardIndices:this.getActiveIndices(),previousCardIndex:s,nextCardIndex:a,completedCards:l,visitedCards:c,totalCards:g,cardsComplete:f,cardValidity:b}}buildItemData(e){let t=this.form.setManager.getAllByParentId(e.id,"card"),r=t.length>0?t.every(c=>c.completed):!0,n=t.length>0?t.every(c=>c.isValid):!0,s=this.form.fieldManager.getAllByParentId(e.id,"card").filter(c=>c.isIncluded),a=s.filter(c=>c.completed).length/s.length*100,l=this.form.conditionManager.evaluateElementCondition(e.element);return{...e,completed:r,isValid:n,progress:a,isIncluded:l}}findParentItem(e){this.logWarn("findParentElement should not be called on CardManager","runtime",{element:e})}};var R=class extends h{constructor(){super(...arguments);o(this,"conditionalElements",new Map);o(this,"affectedElements",new Map)}init(){this.groupStart("Initializing Conditions"),this.discoverConditionalElements(),this.setupEventListeners(),this.logDebug("Initialized",{conditionalElements:this.conditionalElements.size,dependencies:Object.fromEntries(this.affectedElements)}),this.groupEnd()}destroy(){this.conditionalElements.clear(),this.affectedElements.clear(),this.logDebug("ConditionManager destroyed")}discoverConditionalElements(){let e=this.form.getRootElement();if(!e)throw this.createError("Cannot discover conditional elements: root element is null","init",{cause:e});let t=this.form.queryAll(`[${p}-showif], [${p}-hideif]`);this.conditionalElements.clear(),this.affectedElements.clear(),t.forEach(r=>{this.registerCondition(r)}),this.logDebug(`Discovered ${this.conditionalElements.size} conditional elements`,{elements:Array.from(this.conditionalElements.values()),dependencyGraph:Object.fromEntries(this.affectedElements)})}registerCondition(e){let t=e.getAttribute(`${p}-showif`),r=e.getAttribute(`${p}-hideif`);if(!t&&!r)return;let n={element:e,showIfExpression:t?this.parseExpression(t):void 0,hideIfExpression:r?this.parseExpression(r):void 0,dependsOn:new Set};n.showIfExpression&&n.showIfExpression.conditions.forEach(s=>{n.dependsOn.add(s.field),this.addToDependencyGraph(s.field,e)}),n.hideIfExpression&&n.hideIfExpression.conditions.forEach(s=>{n.dependsOn.add(s.field),this.addToDependencyGraph(s.field,e)}),this.conditionalElements.set(e,n)}addToDependencyGraph(e,t){this.affectedElements.has(e)||this.affectedElements.set(e,new Set),this.affectedElements.get(e).add(t)}parseExpression(e){let t=[],r=[],n=e.split(/(\s*(?:&&|\|\|)\s*)/);for(let s=0;s<n.length;s++){let a=n[s].trim();if(a==="&&"||a==="||"){r.push(a);continue}let l=this.parseCondition(a);l&&t.push(l)}return{conditions:t,logicalOperators:r}}parseCondition(e){let t=e.match(/\{([^}]+)\}/);if(!t){this.logWarn(`Invalid condition syntax: ${e}`);return}let r=t[1].trim(),n=e.substring(t.index+t[0].length).trim(),s=n.match(/^(>=|<=|\*=|\^=|\$=|!=|=|>|<)/);if(!s){this.logWarn(`Invalid operator in condition: ${e}`);return}let a=s[1],l=n.substring(a.length).trim();return{field:r,operator:a,value:l}}evaluateElementCondition(e){let t=this.conditionalElements.get(e);if(!t)return!0;let r=!0,n=!1;return t.showIfExpression&&(r=this.evaluateExpression(t.showIfExpression)),t.hideIfExpression&&(n=this.evaluateExpression(t.hideIfExpression)),r&&!n}hasConditions(e){return this.conditionalElements.has(e)}evaluateExpression(e){let{conditions:t,logicalOperators:r}=e;if(t.length===0)return!0;if(t.length===1)return this.evaluateConditionPart(t[0]);let n=this.evaluateConditionPart(t[0]);for(let s=0;s<r.length;s++){let a=r[s],l=t[s+1];if(!l)break;let c=this.evaluateConditionPart(l);a==="&&"?n=n&&c:a==="||"&&(n=n||c)}return n}evaluateConditionPart(e){let{field:t,operator:r,value:n}=e,s=this.getFieldValue(t),a=String(s??"").toLowerCase(),l=n.toLowerCase();switch(console.log("currentValueStr",a),console.log("expectedValueStr",l),r){case"=":return a===l;case"!=":return a!==l;case">":return parseFloat(a)>parseFloat(l);case"<":return parseFloat(a)<parseFloat(l);case">=":return parseFloat(a)>=parseFloat(l);case"<=":return parseFloat(a)<=parseFloat(l);case"*=":return a.includes(l);case"^=":return a.startsWith(l);case"$=":return a.endsWith(l);default:return this.logWarn(`Unknown operator: ${r}`),!1}}getFieldValue(e){let t=this.form.inputManager.getById(e);if(t)return t.value;if(e.startsWith("form.")){let r=e.substring(5);return this.form.getAllState()[r]}this.logWarn(`Field not found: ${e}`)}setupEventListeners(){this.form.subscribe("form:input:changed",e=>{this.onInputChange(e)}),this.logDebug("Event listeners setup")}onInputChange(e){let{name:t}=e,r=this.affectedElements.get(t);!r||r.size===0||(this.logDebug(`Input "${t}" changed, scheduling rebuild for ${r.size} affected elements`),queueMicrotask(()=>{this.logDebug(`Executing deferred rebuild for input "${t}"`),this.form.fieldManager.rebuildAll(),this.form.groupManager.rebuildAll(),this.form.setManager.rebuildAll(),this.form.cardManager.rebuildAll(),r.forEach(n=>{let s=n.getAttribute(`${p}-element`);if(!s)return;let a=y(s);a&&this.form.emit("form:condition:evaluated",{element:n,type:a.type})})}))}getAffectedElements(e){return this.affectedElements.get(e)||new Set}};var z=class extends h{constructor(){super(...arguments);o(this,"handleStateChange",e=>{let t=["currentCardIndex","currentSetIndex","currentGroupIndex","currentFieldIndex"],r=e.key.includes(".")?e.key.split(".").pop():e.key;r&&t.includes(r)&&this.updateDisplay(r)})}init(){this.groupStart("Initializing Display"),this.setupEventListeners(),this.initializeDisplay(),this.logDebug("Initialized"),this.groupEnd()}destroy(){this.logDebug("DisplayManager destroyed")}setupEventListeners(){this.form.subscribe("state:changed",e=>{this.handleStateChange(e)}),this.form.subscribe("form:condition:evaluated",e=>{console.log("form:condition:evaluated",e);let t;switch(e.type){case"card":t=this.form.cardManager;break;case"set":t=this.form.setManager;break;case"group":t=this.form.groupManager;break;case"field":t=this.form.fieldManager;break;default:return}this.handleVisibility(t,!0)}),this.logDebug("DisplayManager event listeners setup")}initializeDisplay(){this.handleVisibility(this.form.cardManager),this.handleVisibility(this.form.setManager),this.handleVisibility(this.form.groupManager),this.handleVisibility(this.form.fieldManager),this.removeInitialStyles()}removeInitialStyles(){this.form.queryAll(`[${p}-initialdisplay]`).forEach(t=>{t.removeAttribute(`${p}-initialdisplay`)})}updateDisplay(e){let t=e.toLowerCase();t.includes("card")&&this.handleVisibility(this.form.cardManager),t.includes("set")&&this.handleVisibility(this.form.setManager),t.includes("group")&&this.handleVisibility(this.form.groupManager),t.includes("field")&&this.handleVisibility(this.form.fieldManager)}handleVisibility(e,t=!1){let r=e.getAll();t&&console.log("items",r),r.forEach(n=>{this.showElement(n,s=>e.updateItemData(n.index,{visible:s}))})}showElement(e,t){let{element:r,active:n,type:s,isIncluded:a}=e,l=n&&a;l?r.style.removeProperty("display"):r.style.setProperty("display","none"),r.setAttribute(`${p}-${s}-active`,n.toString()),r.setAttribute(`${p}-${s}-included`,a.toString()),t(l)}};var G=class extends I{constructor(){super(...arguments);o(this,"itemType","field")}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(n.type!==this.itemType)return;let s=n.id||`${this.itemType}-${t}`,a=this.findParentItem(e);if(!a)throw this.createError("Cannot discover fields: no parent element found","init",{cause:{manager:"FieldManager",element:e}});let l=this.findParentHierarchy(a),c=this.determineActive(e,t);return{element:e,index:t,id:s,visible:!0,active:c,type:this.itemType,parentHierarchy:l,current:c&&t===0,visited:c,completed:!1,isIncluded:!0,isValid:!1}}calculateStates(){let e=this.getCurrent(),t=e?e.index:-1,r=e?e.id:null,n=t>0?t-1:null,s=t<this.length-1?t+1:null,a=new Set(this.getByFilter(u=>u.completed).map(u=>u.id)),l=new Set(this.getByFilter(u=>u.visited).map(u=>u.id)),c=this.length,g=this.getByFilter(u=>u.isIncluded).length,f=a.size,b=this.getAll().reduce((u,v)=>(u[v.id]=v.isValid,u),{});return{currentFieldIndex:t,currentFieldId:r,activeFieldIndices:this.getActiveIndices(),previousFieldIndex:n,nextFieldIndex:s,completedFields:a,visitedFields:l,totalFields:c,totalIncludedFields:g,fieldsComplete:f,fieldValidity:b}}buildItemData(e){let t=this.form.inputManager.getByFind(a=>a.parentHierarchy.fieldId===e.id);if(!t)throw this.createError("Cannot merge field data: input not found","runtime",{cause:{manager:"FieldManager",element:e,input:t}});let{completed:r,isValid:n}=t,s=this.form.conditionManager.evaluateElementCondition(e.element);return console.log("buildFieldData",{...e,completed:r,isValid:n,isIncluded:s}),{...e,completed:r,isValid:n,isIncluded:s}}findParentItem(e){let t=m.findParentByElement(e,"group",()=>this.form.groupManager.getAll()),r=m.findParentByElement(e,"set",()=>this.form.setManager.getAll());return t??r}};var N=class extends h{constructor(){super(...arguments);o(this,"handleNavigationChanged",()=>{let e=this.form.getState("currentFieldIndex");if(e<0)return;let t=this.form.inputManager.getByIndex(e);!t||!t.active||this.focusElement(t.element)})}init(){this.setupEventListeners()}destroy(){}setupEventListeners(){this.form.subscribe("form:navigation:changed",()=>{this.handleNavigationChanged()})}isFocusable(e){return!e.hasAttribute("disabled")&&e.offsetParent!==null&&e.tabIndex>=0}focusElement(e,t=!0){if(!this.isFocusable(e))return!1;try{return e.focus(),t&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),!0}catch(r){return this.logError("Failed to focus element",r),!1}}};var _=class extends I{constructor(){super(...arguments);o(this,"itemType","group")}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(n.type!==this.itemType)return;let s=F(e,this.itemType,n.id,t),a=this.findParentHierarchy(e),l=this.determineActive(e,t);return{element:e,index:t,id:s.id,visible:!0,active:l,type:this.itemType,parentHierarchy:a,current:l&&t===0,visited:l,completed:!1,title:s.title,progress:0,isIncluded:!0,isValid:!1}}calculateStates(){let e=this.getCurrent(),t=e?e.index:-1,r=e?e.id:null,n=e?e.title:null,s=t>0?t-1:null,a=t<this.length-1?t+1:null,l=new Set(this.getByFilter(u=>u.completed).map(u=>u.id)),c=new Set(this.getByFilter(u=>u.visited).map(u=>u.id)),g=this.length,f=l.size,b=this.getAll().reduce((u,v)=>(u[v.id]=v.isValid,u),{});return{currentGroupIndex:t,currentGroupId:r,currentGroupTitle:n,activeGroupIndices:this.getActiveIndices(),previousGroupIndex:s,nextGroupIndex:a,completedGroups:l,visitedGroups:c,totalGroups:g,groupsComplete:f,groupValidity:b}}buildItemData(e){let t=this.form.fieldManager.getAllByParentId(e.id,"group").filter(l=>l.isIncluded),r=t.every(l=>l.completed),n=t.every(l=>l.isValid),s=t.filter(l=>l.completed).length/t.length*100,a=this.form.conditionManager.evaluateElementCondition(e.element);return{...e,completed:r,isValid:n,progress:s,isIncluded:a}}findParentItem(e){return m.findParentByElement(e,"set",()=>this.form.setManager.getAll())}};var q=class extends I{constructor(){super(...arguments);o(this,"itemType","input");o(this,"activeListeners",[])}init(){super.init(!1),this.setupEventListeners(),this.onInitialized()}destroy(){this.unbindAllInputs(),super.destroy()}discoverItems(){let e=this.form.fieldManager.getAll();this.clear();let t=new Set;e.forEach((r,n)=>{let s=Array.from(r.element.querySelectorAll("input, select, textarea"));if(s.length===0){this.form.logWarn(`Field "${r.id}" has no inputs`,{field:r});return}let a=this.findParentHierarchy(r);s.forEach(l=>{let c=this.createInputData(l,n,{field:r,processedNames:t,parentHierarchy:a,isGroup:s.length>1});c&&this.update(c)})}),this.logDebug(`Discovered ${this.length} ${this.itemType}s`,{elements:this.getAll()})}createItemData(){}createInputData(e,t,r){let{field:n,processedNames:s,parentHierarchy:a,isGroup:l}=r,c=e.getAttribute("name");if(!c)throw this.createError("Cannot discover inputs: Input missing name attribute","init",{cause:{input:e,field:a.fieldId,group:a.groupId,set:a.setId,card:a.cardId,form:a.formId}});if(s.has(c)){let w=this.getById(c);w&&(w.inputs.push(e),w.isGroup=w.inputs.length>1,this.mergeItemData(w,{}));return}s.add(c);let g=this.getInputType(e),f=this.checkIfRequired(e),b=this.checkIfValid(e),{visited:u,active:v,current:ne,isIncluded:J}=n;return{element:e,index:t,id:c,visible:!0,active:v,type:"input",parentHierarchy:a,current:ne,visited:u,completed:b,inputs:[e],inputType:g,value:this.getInputValue(e),name:c,isGroup:l,isRequiredOriginal:f,isRequired:f,isValid:b,isIncluded:J}}calculateStates(){return{formData:this.getFormData()}}buildItemData(e){let t=this.checkIfValid(e.element),r=this.form.fieldManager.getById(e.parentHierarchy.fieldId),n=r?r.isIncluded:!0,s=n?e.isRequiredOriginal:!1;return{...e,completed:t,value:this.getValue(e.name),isIncluded:n,isRequired:s,isValid:t}}setupEventListeners(){this.bindActiveInputs(),this.form.subscribe("state:changed",e=>{let t=["activeFieldIndices"],r=e.key.includes(".")?e.key.split(".").pop():e.key;!r||!t.includes(r)||r==="activeFieldIndices"&&this.handleActiveFieldsChanged()})}handleActiveFieldsChanged(){this.bindActiveInputs(),this.unbindInactiveInputs()}bindActiveInputs(){let e=0;this.getActive().forEach(r=>{if(r.inputs.some(a=>this.activeListeners.some(l=>l.element===a)))return;let s=this.getEventTypeForInput(r.element);r.inputs.forEach(a=>{let l=()=>{let c=this.extractInputValue(r);this.handleInputChange(r.name,c)};a.addEventListener(s,l),this.activeListeners.push({element:a,index:r.index,name:r.name,event:s,handler:l})}),this.logDebug(`Bound "${s}" events to input "${r.name}"`),e+=1}),this.logDebug(`Bound listeners to ${e} input${e!==1?"s":""}`)}unbindInactiveInputs(){let e=0,t=this.getActive();this.activeListeners=this.activeListeners.filter(r=>{let n=!t.find(s=>s.index===r.index);return n&&(r.element.removeEventListener(r.event,r.handler),this.logDebug(`Unbound "${r.event}" events from input "${r.name}"`),e+=1),!n}),this.logDebug(`Unbound listeners from ${e} input${e!==1?"s":""}`)}unbindAllInputs(){this.activeListeners.forEach(e=>{e.element.removeEventListener(e.event,e.handler)}),this.activeListeners=[]}getEventTypeForInput(e){if(e instanceof HTMLSelectElement)return"change";if(e instanceof HTMLTextAreaElement)return"input";let t=e.type.toLowerCase();return["radio","checkbox"].includes(t)?"change":"input"}extractInputValue(e){let{element:t}=e;if(t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)return t.value;let r=e.inputType;if(r==="checkbox")return e.isGroup?e.inputs.filter(n=>n.checked).map(n=>n.value):t.checked;if(r==="radio"){let n=e.inputs.find(s=>s.checked);return console.log("Radio",e,n),n?n.value:null}return t.value}getValue(e){let t=this.getBySelector(e);if(t)return t.value}getInputValue(e){if(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)return e.value;let t=e.type.toLowerCase();return t==="checkbox"||t==="radio"?e.checked:e.value}setValue(e,t){let r=this.getBySelector(e);if(!r){this.form.logWarn(`Cannot set value for input "${e}" - not found`);return}let{element:n}=r;if(n instanceof HTMLSelectElement||n instanceof HTMLTextAreaElement){n.value=String(t);return}let s=r.inputType;if(s==="checkbox"){Array.isArray(t)?r.inputs.forEach(a=>{a.checked=t.includes(a.value)}):n.checked=!!t;return}if(s==="radio"){r.inputs.forEach(a=>{a.checked=a.value===String(t)});return}n.value=String(t)}getFormData(){let e={};return this.getAll().forEach(t=>{e[t.name]=this.extractInputValue(t)}),e}handleInputChange(e,t){this.updateItemData(e,{value:t});let r={name:e,value:t},n=this.form.getState("formData");this.form.setState("formData",{...n,[r.name]:r.value}),this.form.emit("form:input:changed",r),this.logDebug(`Input "${e}" changed to:`,t)}setInputRequired(e,t){e.isRequired=t,e.inputs.forEach(r=>{r.required=t})}findParentItem(e){let t=m.findParentByElement(e,"field",()=>this.form.fieldManager.getAll());if(!t)throw this.createError("Cannot discover inputs: no parent field found","init",{cause:{manager:"InputManager",element:e}});return t}getInputType(e){return e instanceof HTMLSelectElement?"select":e instanceof HTMLTextAreaElement?"textarea":e.type.toLowerCase()}checkIfRequired(e){return e.required}checkIfValid(e){return e.checkValidity()}};var U=class extends h{constructor(){super(...arguments);o(this,"navigationEnabled",!0)}init(){this.groupStart("Initializing Navigation"),this.setupEventListeners(),this.form.logDebug("Initialized"),this.groupEnd()}destroy(){this.form.logDebug("NavigationManager destroyed")}setupEventListeners(){this.form.subscribe("form:navigation:request",e=>{this.handleMove(e.type)}),this.form.logDebug("Event listeners setup")}handleMove(e){if(!this.navigationEnabled)return;let t=this.form.getBehavior(),r;switch(t){case"byField":r=this.byField(e);break;case"byGroup":r=this.byGroup(e);break;case"bySet":r=this.bySet(e);break;case"byCard":r=this.byCard(e);break;default:throw this.form.createError("Invalid behavior","runtime",{cause:{behavior:t}})}r&&this.form.emit("form:navigation:changed",{to:r})}byField(e){let t=e==="prev"?this.form.fieldManager.getPrevPosition():this.form.fieldManager.getNextPosition();if(t===void 0)return this.byGroup(e);let r=this.form.fieldManager.getByIndex(t);if(!r)throw this.form.createError("Cannot handle navigation: target field is null","runtime",{cause:{targetPosition:t,targetField:r,direction:e}});return this.clearHierarchyData("field"),this.setChildrenActive(r),this.updateHierarchyData(r),this.batchStateUpdates(),"field"}byGroup(e){let t=e==="prev"?this.form.groupManager.getPrevPosition():this.form.groupManager.getNextPosition();if(t===void 0)return this.bySet(e);let r=this.form.groupManager.getByIndex(t);if(!r)throw this.form.createError("Cannot handle navigation: target group is null","runtime",{cause:{targetPosition:t,targetGroup:r,direction:e}});return this.clearHierarchyData("group"),this.form.groupManager.updateItemData(r.id,{active:!0,current:!0}),this.setChildrenActive(r),this.updateHierarchyData(r),this.batchStateUpdates(),"group"}bySet(e){let t=e==="prev"?this.form.setManager.getPrevPosition():this.form.setManager.getNextPosition();if(t===void 0)return this.byCard(e);let r=this.form.setManager.getByIndex(t);if(!r)throw this.form.createError("Cannot handle navigation: target set is null","runtime",{cause:{targetPosition:t,targetSet:r,direction:e}});return this.clearHierarchyData("set"),this.form.setManager.setActive(r.id),this.form.setManager.setCurrent(r.id),this.setChildrenActive(r),this.updateHierarchyData(r),this.batchStateUpdates(),"set"}byCard(e){let t=e==="prev"?this.form.cardManager.getPrevPosition():this.form.cardManager.getNextPosition();if(t===void 0)return;let r=this.form.cardManager.getByIndex(t);if(!r)throw this.form.createError("Cannot handle navigation: target card is null","runtime",{cause:{targetPosition:t,targetCard:r,direction:e}});return this.clearHierarchyData("card"),this.form.cardManager.setActive(r.id),this.form.cardManager.setCurrent(r.id),this.setChildrenActive(r),this.batchStateUpdates(),"card"}clearHierarchyData(e){e==="card"&&this.form.cardManager.clearActiveAndCurrent(),(e==="card"||e==="set")&&this.form.setManager.clearActiveAndCurrent(),(e==="card"||e==="set"||e==="group")&&this.form.groupManager.clearActiveAndCurrent(),this.form.fieldManager.clearActiveAndCurrent()}setChildrenActive(e){e.type==="card"&&this.form.setManager.setActiveByParent(e.id,e.type,{firstIsCurrent:!0}),(e.type==="card"||e.type==="set")&&this.form.groupManager.setActiveByParent(e.id,e.type,{firstIsCurrent:!0}),(e.type==="card"||e.type==="set"||e.type==="group")&&this.form.fieldManager.setActiveByParent(e.id,e.type,{firstIsCurrent:!0}),this.form.inputManager.clearActiveAndCurrent(),this.form.fieldManager.getActive().forEach((r,n)=>{this.form.inputManager.setActiveByParent(r.id,"field",{firstIsCurrent:n===0})})}updateHierarchyData(e){if(e.type==="field"){let{groupIndex:r}=e.parentHierarchy;r!==null&&r>=0&&(this.form.groupManager.clearActiveAndCurrent(),this.form.groupManager.setActive(r),this.form.groupManager.setCurrent(r))}if(e.type==="field"||e.type==="group"){let{setIndex:r}=e.parentHierarchy;r!==null&&r>=0&&(this.form.setManager.clearActiveAndCurrent(),this.form.setManager.setActive(r),this.form.setManager.setCurrent(r))}let{cardIndex:t}=e.parentHierarchy;t!==null&&t>=0&&(this.form.cardManager.clearActiveAndCurrent(),this.form.cardManager.setActive(t),this.form.cardManager.setCurrent(t))}batchStateUpdates(){this.form.inputManager.rebuildAll(),this.form.fieldManager.rebuildAll(),this.form.groupManager.rebuildAll(),this.form.setManager.rebuildAll(),this.form.cardManager.rebuildAll(),console.log("batchStateUpdates",{inputs:this.form.inputManager.getAll(),fields:this.form.fieldManager.getAll(),groups:this.form.groupManager.getAll(),sets:this.form.setManager.getAll(),cards:this.form.cardManager.getAll()});let e={...this.form.inputManager.calculateStates(),...this.form.fieldManager.calculateStates(),...this.form.groupManager.calculateStates(),...this.form.setManager.calculateStates(),...this.form.cardManager.calculateStates()};this.form.setStates(e)}};var re=class re extends h{constructor(){super(...arguments);o(this,"store",new A)}init(){this.groupStart("Initializing Progress"),this.discoverItems(),this.setupEventListeners(),this.form.logDebug("Initialized"),this.groupEnd()}destroy(){this.store.clear()}discoverItems(){let e=this.form.getRootElement();if(!e)throw this.form.createError("Cannot discover progress items: root element is null","init",{cause:e});let t=this.form.queryAll(`[${p}-element="progress-line"]`);this.store.clear(),t.forEach((r,n)=>{let s=this.createItemData(r,n);s&&this.store.add(s)}),this.form.logDebug(`Discovered ${this.store.length} progress lines`,{items:this.store.getAll()})}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(n)return this.buildItemData({element:e,index:t,id:n.id??`progress-line-${t}`,visible:!0,active:!1,type:n.type,parentHierarchy:this.findParentHierarchy(e)})}buildItemData(e){return{...e,active:!0}}findParentHierarchy(e){return m.findParentHierarchy(e,this.form,t=>this.findParentItem(t))}findParentItem(e){let t=m.findParentByElement(e,"group",()=>this.form.groupManager.getAll()),r=m.findParentByElement(e,"set",()=>this.form.setManager.getAll()),n=m.findParentByElement(e,"card",()=>this.form.cardManager.getAll());return t??r??n}setupEventListeners(){this.form.subscribe("form:navigation:changed",()=>{this.updateProgress()})}updateProgress(){this.store.getAll().forEach(e=>{let t=this.getProgressForBehavior(e);t!==void 0&&e.element.style.setProperty("--progress",t.toString())})}getProgressForBehavior(e){let t=this.form.getBehavior(),{parentHierarchy:r}=e,n=this.getParentContext(r);if(!n)return;let[s,a]=n,l=re.PROGRESS_CONFIG[s]?.[t];if(!l)return;let{manager:c,parentType:g,stateKey:f}=l,b=this.form[c],u=g==="form"?b.getAll():b.getAllByParentId(a,g);if(u.length===0)return;let ne=this.form.getAllState()[f],J=u.findIndex(w=>w.index===ne);if(J!==-1)return(J+1)/u.length*100}getParentContext(e){if("setId"in e&&e.setId)return["set",e.setId];if("cardId"in e&&e.cardId)return["card",e.cardId];if(e.formId)return["form",e.formId]}};o(re,"PROGRESS_CONFIG",{form:{byCard:{manager:"cardManager",parentType:"form",stateKey:"currentCardIndex"},bySet:{manager:"setManager",parentType:"form",stateKey:"currentSetIndex"},byGroup:{manager:"groupManager",parentType:"form",stateKey:"currentGroupIndex"},byField:{manager:"fieldManager",parentType:"form",stateKey:"currentFieldIndex"}},card:{bySet:{manager:"setManager",parentType:"card",stateKey:"currentSetIndex"},byGroup:{manager:"groupManager",parentType:"card",stateKey:"currentGroupIndex"},byField:{manager:"fieldManager",parentType:"card",stateKey:"currentFieldIndex"}},set:{byGroup:{manager:"groupManager",parentType:"set",stateKey:"currentGroupIndex"},byField:{manager:"fieldManager",parentType:"set",stateKey:"currentFieldIndex"}}});var W=re;var j=class extends I{constructor(){super(...arguments);o(this,"itemType","set")}createItemData(e,t){if(!(e instanceof HTMLElement))return;let r=e.getAttribute(`${p}-element`);if(!r)return;let n=y(r);if(n.type!==this.itemType)return;let s=F(e,this.itemType,n.id,t),a=this.findParentHierarchy(e),l=this.determineActive(e,t);return{element:e,index:t,id:s.id,visible:!0,active:l,parentHierarchy:a,current:l&&t===0,visited:l,completed:!1,type:this.itemType,title:s.title,progress:0,isIncluded:!0,isValid:!1}}calculateStates(){let e=this.getCurrent(),t=e?e.index:-1,r=e?e.id:null,n=e?e.title:null,s=t>0?t-1:null,a=t<this.length-1?t+1:null,l=new Set(this.getByFilter(u=>u.completed).map(u=>u.id)),c=new Set(this.getByFilter(u=>u.visited).map(u=>u.id)),g=this.length,f=l.size,b=this.getAll().reduce((u,v)=>(u[v.id]=v.isValid,u),{});return{currentSetIndex:t,currentSetId:r,currentSetTitle:n,activeSetIndices:this.getActiveIndices(),previousSetIndex:s,nextSetIndex:a,completedSets:l,visitedSets:c,totalSets:g,setsComplete:f,setValidity:b}}buildItemData(e){let t=this.form.groupManager.getAllByParentId(e.id,"set"),r=this.form.fieldManager.getAllByParentId(e.id,"set").filter(g=>g.isIncluded),n=t.length>0?t:r,s=n.every(g=>g.completed),a=n.every(g=>g.isValid),l=n.filter(g=>g.completed).length/n.length*100,c=this.form.conditionManager.evaluateElementCondition(e.element);return{...e,completed:s,isValid:a,progress:l,isIncluded:c}}findParentItem(e){return m.findParentByElement(e,"card",()=>this.form.cardManager.getAll())}};var ie=class extends ee{constructor(e){super(e);o(this,"config");o(this,"cardManager");o(this,"setManager");o(this,"groupManager");o(this,"fieldManager");o(this,"inputManager");o(this,"buttonManager");o(this,"navigationManager");o(this,"displayManager");o(this,"progressManager");o(this,"focusManager");o(this,"conditionManager");this.setRootElement(e.selector),this.config=this.parseConfiguration(),this.cardManager=new O(this),this.setManager=new j(this),this.groupManager=new _(this),this.fieldManager=new G(this),this.inputManager=new q(this),this.buttonManager=new K(this),this.navigationManager=new U(this),this.displayManager=new z(this),this.progressManager=new W(this),this.focusManager=new N(this),this.conditionManager=new R(this),this.config.autoInit&&!this.isInitialized()&&this.init()}parseConfiguration(){let e=pe(this.rootElement);if(!e.name)throw this.createError("Invalid configuration: No name is provided for form","init",{cause:{element:this.rootElement,name:e.name}});if(e.behavior&&!ge(e.behavior))throw this.createError("Invalid configuration: Behavior must be 'byField', 'bySet', 'byGroup', or 'byCard'","init",{cause:{behavior:e.behavior}});if(e.transition&&!fe(e.transition))throw this.createError('Invalid configuration: Transition must be "fade", "slide", or "none"',"init",{cause:{transition:e.transition}});if(e.transitionduration&&isNaN(parseFloat(e.transitionduration)))throw this.createError("Invalid configuration: Transition duration must be a number","init",{cause:{transitionDuration:e.transitionduration}});if(e.allowinvalid&&!["true","false",""].includes(e.allowinvalid))throw this.createError("Invalid configuration: Allow invalid must be 'true' or 'false'","init",{cause:{allowInvalid:e.allowinvalid}});if(e.errordisplay&&!me(e.errordisplay))throw this.createError("Invalid configuration: Error display mode must be 'native'","init",{cause:{errordisplay:e.errordisplay}});if(e.ariaannounce&&!["true","false",""].includes(e.ariaannounce))throw this.createError("Invalid configuration: Aria announce must be 'true' or 'false'","init",{cause:{ariaAnnounce:e.ariaannounce}});if(e.focusonchange&&!["true","false",""].includes(e.focusonchange))throw this.createError("Invalid configuration: Focus on change must be 'true' or 'false'","init",{cause:{focusOnChange:e.focusonchange}});if(e.autoinit&&!["true","false",""].includes(e.autoinit))throw this.createError("Invalid configuration: Auto init must be 'true' or 'false'","init",{cause:{autoInit:e.autoinit}});if(e.persist&&!he(e.persist))throw this.createError("Invalid configuration: Persist must be 'memory'","init",{cause:{persist:e.persist}});return{name:e.name||"untitled-form",behavior:e.behavior||"byField",transition:e.transition||"none",transitionDuration:ve(e.transitionduration,300),validateOn:e.validateon||"blur",allowInvalid:k(e.allowinvalid,!1),errorDisplay:e.errordisplay||"native",ariaAnnounce:k(e.ariaannounce,!0),focusOnChange:k(e.focusonchange,!0),autoInit:k(e.autoinit,!1),persist:e.persist||"memory",debug:k(e.debug,!1)}}async setupEventListeners(){}async onInit(){await super.onInit(),this.groupStart(`[FLOWUPS-DEBUG] Form: Initializing "${this.getId()}"`,!1),this.logDebug(`Started at ${new Date().toISOString()}`),this.timeDebug("form:init"),this.conditionManager.init(),this.cardManager.init(),this.setManager.init(),this.groupManager.init(),this.fieldManager.init(),this.inputManager.init(),this.buttonManager.init(),this.displayManager.init(),this.navigationManager.init(),this.progressManager.init(),this.focusManager.init(),this.logDebug("Form initialized",{state:this.getAllState(),timestamp:new Date().toISOString()}),this.timeDebug("form:init",!0),this.groupEnd()}async onDestroy(){this.logDebug("Destroying form"),this.cardManager.destroy(),this.setManager.destroy(),this.groupManager.destroy(),this.fieldManager.destroy(),this.inputManager.destroy(),this.navigationManager.destroy(),this.displayManager.destroy(),this.buttonManager.destroy(),this.progressManager.destroy(),this.focusManager.destroy(),this.conditionManager.destroy(),await super.onDestroy()}handleStateChange(e,t,r){this.logDebug("State changed",{key:e,from:t,to:r})}getFormName(){return this.config.name}getBehavior(){return this.config.behavior}getFormConfig(){return Object.freeze({...this.config})}getState(e){return super.getState(e)}};window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{let d=document.querySelector(`form[${p}-element="form"]`);if(!d||!(d instanceof HTMLFormElement))return;let i=d.getAttribute("name")??"untitled-form";new ie({group:"FORM",id:i,debug:!0,autoInit:!1,selector:d})});})();
